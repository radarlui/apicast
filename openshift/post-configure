if ! grep -q 'listen 8443 ssl;' /opt/openresty/nginx/conf/nginx.conf ; then /usr/bin/sed -i 's|listen 8080;|listen 8080;\n listen 8443 ssl;\n ssl_certificate /etc/nginx-secret-volume/3scale-gateway.crt;\n ssl_certificate_key /etc/nginx-secret-volume/3scale-gateway.key;\n ssl_protocols TLSv1 TLSv1.1 TLSv1.2;|' /opt/openresty/nginx/conf/nginx.conf ; pkill -HUP -o nginx; fi;

if ! grep -q 'proxy_pass https' /opt/openresty/nginx/conf/nginx.conf ; then /usr/bin/sed -i 's|proxy_pass \$proxy_pass ;|proxy_pass https://backend_$service_id; \n proxy_ssl_certificate /etc/nginx-secret-volume/3scale-gateway.crt;\n proxy_ssl_certificate_key /etc/nginx-secret-volume/3scale-gateway.key;\n proxy_ssl_protocols TLSv1 TLSv1.1 TLSv1.2;|' /opt/openresty/nginx/conf/nginx.conf ; pkill -HUP -o nginx; fi;
